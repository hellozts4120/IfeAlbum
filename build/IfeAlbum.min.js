"use strict";function addEvent(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i}function imgIsLoad(t,e){for(var i=[],o=0,r=0,l=t.length;l>r;r++)i.push(new Image),i[r].index=r,i[r].src=t[r],i[r].onload=i[r].onerror=function(){e&&(this.serial=o++,o===t.length?e.call(this,!0):e.call(this,!1))}}function IfeAlbum(t){this.LAYOUT={PUZZLE:1,WATERFALL:2,BARREL:3},this.isFullScreenEnabled=!1,this.modal=new Modal,this.selector=t}var GalleryPuzzle=function(t){this.target=document.querySelector(t),this.photos=[]};GalleryPuzzle.prototype.init=function(){this.target.classList.add("gallery-"+this.photos.length),this.target.innerHTML=this.photos.reduce(function(t,e){return t+='<div class="gallery-item" style="background-image: url('+e+')"></div>'},"")},GalleryPuzzle.prototype.append=function(t){this.photos=t.slice(0,6),this.init(),this.setSize()},GalleryPuzzle.prototype.clear=function(t){for(var e=!0,i=this,o=0;o<t.length;o++)for(var r in i.photos){if(i.photos[r]==t[o]){i.photos.splice(r,1);break}r==i.photos.length-1&&(e=!1)}return this.append(i.photos),e},GalleryPuzzle.prototype.clearAll=function(){this.photos=[],this.setSize()},GalleryPuzzle.prototype.setSize=function(){if(0!=this.photos.length){var t=this.target.querySelectorAll(".gallery-item");this["size"+this.photos.length]().forEach(function(e,i){t[i].style.width=e.width+"px",t[i].style.height=e.height+"px",e.right&&(t[i].style["float"]="right")})}},GalleryPuzzle.prototype.size1=function(){return[{width:this.target.clientWidth,height:this.target.clientHeight}]},GalleryPuzzle.prototype.size2=function(){var t=2*this.target.clientWidth/3;return[{width:t,height:this.target.clientHeight},{width:t,height:this.target.clientHeight}]},GalleryPuzzle.prototype.size3=function(){var t=this.target.clientHeight/2;return[{width:this.target.clientWidth-t,height:this.target.clientHeight},{width:t,height:t},{width:t,height:t}]},GalleryPuzzle.prototype.size4=function(){var t=this.target.clientWidth/2,e=this.target.clientHeight/2;return[{width:t,height:e},{width:t,height:e},{width:t,height:e},{width:t,height:e}]},GalleryPuzzle.prototype.size5=function(){var t=this.target.clientWidth/3,e=this.target.clientHeight/3,i=[{width:2*t,height:2*e},{right:!0,width:t,height:t},{right:!0,width:t,height:this.target.clientHeight-t},{width:t,height:e},{width:t,height:e}];return this.target.clientWidth>2*this.target.clientHeight&&i.push(i.splice(2,1)[0]),i},GalleryPuzzle.prototype.size6=function(){var t=this.target.clientWidth/3,e=this.target.clientHeight/3;return[{width:2*t,height:2*e},{width:t,height:e},{width:t,height:e},{width:t,height:e},{width:t,height:e},{width:t,height:e}]};var GalleryWaterfall=function(t){this.target=document.querySelector(t),this.col=this.setCol(),this.init()};GalleryWaterfall.prototype.init=function(){for(var t=this.target.clientWidth/this.col,e="",i=0;i<this.col;i++)e+='<div class="gallery-column" style="width: '+t+'px"></div>';this.target.innerHTML=e,this.columns=this.target.querySelectorAll(".gallery-column"),this.photos=[]},GalleryWaterfall.prototype.setCol=function(){var t=2;return innerWidth>1200?t=5:innerWidth>992?t=4:innerWidth>768&&(t=3),t},GalleryWaterfall.prototype.append=function(t){if(0==this.photos.length)this.photos=t;else{for(var e in t)this.photos.push(t[e]);for(var e=0;e<this.columns.length;e++)this.columns[e].innerHTML=""}this.photos.forEach(function(t){var e=document.createElement("div");e.className="gallery-item",e.innerHTML='<div class="gallery-photo"><img class="gallery-image"" src="'+t+'"></div>',this.getMinCol().appendChild(e),e.querySelector(".gallery-photo").style.height=parseInt(e.clientWidth/t.aspect_ratio)+"px"}.bind(this))},GalleryWaterfall.prototype.clear=function(t){for(var e=!0,i=this,o=0;o<t.length;o++)for(var r in i.photos){if(i.photos[r]==t[o]){i.photos.splice(r,1);break}r==i.photos.length-1&&(e=!1)}var l=this.photos;return this.clearAll(),this.append(l),e},GalleryWaterfall.prototype.clearAll=function(){for(var t=0;t<this.columns.length;t++)this.columns[t].innerHTML="";this.photos=[]},GalleryWaterfall.prototype.getMinCol=function(){for(var t=this.columns[0],e=0;e<this.columns.length;e++)this.columns[e].clientHeight<t.clientHeight&&(t=this.columns[e]);return t};var GalleryBarrel=function(t,e,i){this.minHeight=e||300,this.maxHeight=i||1e3,this.target=document.querySelector(t),this.padding=8,this.minAspectRatio=this.target.clientWidth/this.minHeight,this.maxAspectRatio=this.target.clientWidth/this.maxHeight,this.photos=[]};GalleryBarrel.prototype.append=function(t){var e=this;if(0==this.photos.length)this.photos=t;else{for(var i in t)this.photos.push(t[i]);document.querySelector(".gallery").innerHTML=""}this.getRows(e.photos).forEach(function(t){var i=e.target.clientWidth-(t.photos.length-1)*e.padding,o=document.createElement("div");o.className="gallery-row";var r=parseInt(i/t.aspectRatio);r>e.maxHeight&&(r=e.maxHeight),o.style.height=r+"px",o.innerHTML=t.photos.reduce(function(t,e){return t+='<div class="gallery-item-wrapper"><div class="gallery-item"><img class="gallery-image" src="'+e+'"></div></div>'},""),e.target.appendChild(o)})},GalleryBarrel.prototype.setHeight=function(t,e){t=t||0,e=e||0,t>0&&(this.minHeight=t,this.minAspectRatio=this.target.clientWidth/this.minHeight),e>0&&(this.maxHeight=e),document.querySelector(".gallery").innerHTML="",this.append(this.photos)},GalleryBarrel.prototype.setBin=function(t,e){this.minNum=t,this.maxNum=e,document.querySelector(".gallery").innerHTML="",this.append(this.photos)},GalleryBarrel.prototype.clear=function(t){var e=!0,i=this;console.log(i.photos);for(var o=0;o<t.length;o++)for(var r in i.photos){if(i.photos[r]==t[o]){i.photos.splice(r,1);break}r==i.photos.length-1&&(e=!1)}var l=this.photos;return this.clearAll(),this.append(l),e},GalleryBarrel.prototype.clearAll=function(){var t=document.querySelector(".gallery");t.innerHTML="",this.photos=[]},GalleryBarrel.prototype.getRows=function(t){for(var e=0,i=[],o=[],r=0;r<t.length;r++){o.push(t[r]);var l=new Image;l.src=t[r],e+=l.naturalWidth/l.naturalHeight,e>this.minAspectRatio&&(i.push({aspectRatio:e,photos:o}),o=[],e=0)}return i.push({aspectRatio:e,photos:o}),i};var Modal=function(){var t=this;this.modal=document.createElement("div"),this.modal.className="modal",this.modal.innerHTML='<div class="modal-container"><img class="modal-image"></div>',addEvent(this.modal,"click",function(e){e.target==t.modal&&(t.modal.classList.remove("active"),document.body.style.overflow="auto")}),this.container=this.modal.querySelector(".modal-container"),this.image=this.modal.querySelector(".modal-image"),document.body.appendChild(this.modal)};Modal.prototype.show=function(t,e,i){if(document.body.style.overflow="hidden",this.modal.classList.add("active"),this.image.src!=t){var o=e/i,r=innerWidth/innerHeight;r>o?this.container.style.width=parseInt(innerHeight*o)+"px":(this.container.style.width=innerWidth+"px",this.container.style.marginTop=(innerHeight-innerWidth/o)/2+"px"),this.image.src=t}},IfeAlbum.prototype.setImage=function(t,e){if("string"==typeof t)return void this.setImage([t]);var i=this;imgIsLoad(t,function(e){e&&(i.photos=t,i.layout.clearAll(),i.layout.append(t))})},IfeAlbum.prototype.getImageDomElements=function(){return document.querySelectorAll(".gallery-image")},IfeAlbum.prototype.addImage=function(t){return"string"==typeof t?void this.addImage([t]):void("PUZZLE"==this.getLayout||this.layout.append(t))},IfeAlbum.prototype.removeImage=function(t){return"string"==typeof t?void this.removeImage([t]):this.layout.clear(t)},IfeAlbum.prototype.setLayout=function(t){var e=this;switch(t){case 1:e.layout=new GalleryPuzzle(e.selector);break;case 2:e.layout=new GalleryWaterfall(e.selector);break;case 3:e.layout=new GalleryBarrel(e.selector)}this.layout.name=Object.keys(this.LAYOUT)[t-1]},IfeAlbum.prototype.getLayout=function(){return this.layout.name},IfeAlbum.prototype.setGutter=function(t,e){if(void 0==t)return void console.error("x must be greater than 0!");if("PUZZLE"==this.getLayout())return void console.error("拼图布局，为获得良好体验，不能设置图片间距！");if(e=e||t,this.gutter=[t,e],"WATERFALL"==this.getLayout())var i=document.querySelectorAll(".gallery-item");if("BARREL"==this.getLayout())var i=document.querySelectorAll(".gallery-item-wrapper");for(var o=0;o<i.length;o++)i[o].style.borderTop=e/2+"px solid #f0f0f0",i[o].style.borderBottom=e/2+"px solid #f0f0f0",i[o].style.borderLeft=t/2+"px solid #f0f0f0",i[o].style.borderRight=t/2+"px solid #f0f0f0"},IfeAlbum.prototype.enableFullscreen=function(){this.isFullScreenEnabled=!0,document.addEventListener("click",this.click.bind(this))},IfeAlbum.prototype.disableFullscreen=function(){this.isFullScreenEnabled=!1,document.removeEventListener("click",this.click.bind(this))},IfeAlbum.prototype.isFullscreenEnabled=function(){return this.isFullScreenEnabled},IfeAlbum.prototype.setBarrelBin=function(t,e){return void 0===t||void 0===e||t>e?void console.error("error occurs!"):"BARREL"!=this.getLayout()?void console.error("Not Barrel now!"):void this.layout.setBin(t,e)},IfeAlbum.prototype.getBarrelBinMax=function(){return this.layout.maxNum},IfeAlbum.prototype.getBarrelBinMin=function(){return this.layout.minNum},IfeAlbum.prototype.setBarrelHeight=function(t,e){return"BARREL"!=this.getLayout()?void console.error("Not Barrel now!"):(t>e&&console.error("max height must be greater or same as the min height!"),void this.layout.setHeight(t,e))},IfeAlbum.prototype.getBarrelHeightMax=function(){return this.layout.minHeight},IfeAlbum.prototype.getBarrelHeightMin=function(){return this.layout.maxHeight},IfeAlbum.prototype.click=function(t){console.log(typeof t);var e=t.target;("gallery-image"==e.className||"PUZZLE"==this.getLayout()&&"gallery-item"==e.className)&&this.modal.show(e.src||e.style.backgroundImage.split('"')[1],e.clientWidth,e.clientHeight)},"undefined"==typeof window.ifeAlbum&&(window.ifeAlbum=new IfeAlbum(".gallery"));